<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>

  <link rel="stylesheet" href="https://unpkg.com/netlify-cms@0.7.3/dist/cms.css" />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <script src="https://unpkg.com/netlify-cms@0.7.3/dist/cms.js"></script>
  <script src="https://unpkg.com/prop-types@15.6.0/prop-types.min.js"></script>
<script>
const subscribers = new Set()
let strings
window.CMS_CHANNEL = {
  getStrings: () => strings,
  subscribe: fn => {
    subscribers.add(fn)
  },
  unsubscribe: fn => {
    subscribe.remove(fn)
  },
}

const PagePreview = createClass({
  render: function() {
    strings = this.props.entry.get('data')

    // notify
    subscribers.forEach(s => {
      s(strings)
    })

    return h('iframe', {
      src: '../index.html',
      style: {
        height: '100%',
        width: '100%',
        border: 'none',
        background: '#fff',
      },
    })
  },
})

PagePreview.contextTypes = {
  document: PropTypes.any,
}

// simple stylesheet that makes the inner iframe fill the outer iframe
CMS.registerPreviewStyle('preview.css')
CMS.registerPreviewTemplate('home', PagePreview)
</script>
</body>
</html>
